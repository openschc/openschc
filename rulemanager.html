
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>OpenSCHC Rule Manager Module &#8212; OpenSCHC  documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="OpenSCHC Bit Buffer Management Module" href="bitarray.html" />
    <link rel="prev" title="IETF Hackathon specific informations" href="IETF-104-Hackathon-LPWAN.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-rulemanager">
<span id="openschc-rule-manager-module"></span><h1>OpenSCHC Rule Manager Module<a class="headerlink" href="#module-rulemanager" title="Permalink to this headline">¶</a></h1>
<p>## Base format</p>
<p>A context and rule is written in JSON.</p>
<p>A context contains an identifier, AND one or three rules.
One of rules must specify the SCHC Compression/Decompression (CD).
Two specify SCHC Fragmentation/Reassembly (FR) if needed.</p>
<p>Therefore, a context has to be formed to either below structures.</p>
<blockquote>
<div><dl class="docutils">
<dt>{</dt>
<dd>“devL2Addr”: …,
“dstIID”: …,
“comp”: { … },
“fragSender”: { … },
“fragReceiver”: { … }</dd>
</dl>
<p>}</p>
<p>“comp”: compression rule.
“fragSender”: fragmentation rule for inbound.
“fragReceiver”: fragmentation rule for outbound.</p>
</div></blockquote>
<p>Or,</p>
<blockquote>
<div><dl class="docutils">
<dt>{</dt>
<dd>“devL2Addr”: …,
“dstIID”: …,
“profile”: { … },
“comp”: { … }</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>XXX Q. “profile” should be in the context ?</p>
<p>## Context</p>
<p>A context is uniquely identified by devL2Addr
specifying the L2 address of a SCHC device.</p>
<p>dstIID matches the IP address assigned
to the interface of the communication peer.
In the context of the SCHC device, dstIID indicates the IP address of
the interface at the SCHC Translator,
which is dedicated between the device and
the application.
In the context of the other side, dstIID indicates the IP address of
the SCHC device.</p>
<blockquote>
<div><p>+——–+                       +————+         +—–+
|  SCHC  |                       |    SCHC    <a href="#id5"><span class="problematic" id="id6">|---------|</span></a> App |
| Device |                       | Translator |         |     |
+——–+                       +————+         +—–+</p>
<blockquote>
<div><div class="line-block">
<div class="line">D (IP addr)                     | T (IP addr)</div>
<div class="line">L (L2 addr)                     |</div>
<div class="line-block">
<div class="line"><a href="#id1"><span class="problematic" id="id2">|</span></a></div>
</div>
</div>
<p>+–// LPWAN //–| GW <a href="#id3"><span class="problematic" id="id4">|</span></a>————+</p>
</div></blockquote>
</div></blockquote>
<p>In the above example, the context of each side is like below:</p>
<blockquote>
<div><p>at the device:</p>
<dl class="docutils">
<dt>{</dt>
<dd>“devL2Addr”: “L”,
“dstIID”: “M”</dd>
</dl>
<p>}</p>
<p>at the translator:</p>
<dl class="docutils">
<dt>{</dt>
<dd>“devL2Addr”: “L”,
“dstIID”: “D”</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>“*” and “/” can be used for a wild-card match. (XXX should be implemented.)</p>
<p>## Rule</p>
<p>XXX is it true that both ruleID and ruleLength is unique key ?
XXX is the deivce L2 address the real key ?</p>
<p>A rule is uniquely identified by the rule ID of variable length.
Each rule must contain the following information:</p>
<blockquote>
<div><dl class="docutils">
<dt>{</dt>
<dd>“ruleID” : 2,
“ruleLength” : 3</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>where ruleID contains the rule ID value aligned on the right and ruleLength
gives
the size in bits of the ruleID. In the previous example, this corresponds to
the binary value 0b010.
if ruleLength is not specified the value is set to 1 byte.</p>
<p>The rule is either a compression/decompression rule
or a fragmentation/reassembly rule.
For C/D rules, the keyword “compression” must be defined.
For F/R rules, the keyword “fragmentation” and “fragmentation”
must be defined.</p>
<p>## Compression Rule</p>
<p>A compression rule is bidirectionnal.</p>
<p>## Fragmentation Rule</p>
<p>A fragmentation rule is uni directionnal.</p>
<p>The “fragmentation” keyword is used to give fragmentation mode and profile:
- one fragmentation mode keywork “noAck”, “ackAlways” or “ackOnError”.
- FRModeProfile parameters. Default values are automaticaly added.
- dtagSize, WSize and FCNSize are used to define the SCHC fragmentation header
- windowSize can be added if not 2^FCNSize - 1</p>
<blockquote>
<div><p>For “ackOnError” the following parameter is defined:
- “ackBehavior” defined the ack behavior, i.e. when the Ack must be spontaneously sent</p>
<blockquote>
<div>by the receiver and therefore when the sender must listen for Ack.
- “afterAll0” means that the sender waits for ack after sending an All-0
- “afterAll1” means that the sender waits only after sending the last fragment
- other behaviors may be defined in the future.</div></blockquote>
</div></blockquote>
<p>## data model of DB</p>
<blockquote>
<div><dl class="docutils">
<dt>db = [</dt>
<dd><dl class="first docutils">
<dt>{</dt>
<dd><p class="first">“devL2Addr”: ..,
“dstIID”: ..,
“comp”: {</p>
<blockquote>
<div><blockquote>
<div>“ruleID”: ..,
“ruleLength”: ..,
“compression”: { …}</div></blockquote>
<p>},</p>
</div></blockquote>
<dl class="last docutils">
<dt>“fragSender”: {</dt>
<dd><blockquote class="first">
<div>“ruleID”: ..,
“ruleLength”: ..,
“fragmentation”: { …}</div></blockquote>
<p class="last">}</p>
</dd>
<dt>“fragReceiver”: {</dt>
<dd><blockquote class="first">
<div>“ruleID”: ..,
“ruleLength”: ..,
“fragmentation”: { …}</div></blockquote>
<p class="last">}</p>
</dd>
</dl>
</dd>
</dl>
<p class="last">}, …</p>
</dd>
</dl>
<p>]</p>
</div></blockquote>
<p>## method</p>
<ul>
<li><p class="first">add_context(context, comp=None, fragSender=None, fragReceiver=None)</p>
<blockquote>
<div><p>It adds the context.  If it exists, raise ValueError.</p>
</div></blockquote>
</li>
<li><p class="first">add_rules(context, comp=None, fragSender=None, fragReceiver=None)</p>
<blockquote>
<div><p>It adds the list of rules into the context specified.
If it exists, raise ValueError.
If context is not specified, the rule will be added into the default
context.</p>
</div></blockquote>
</li>
</ul>
<p>## Rule to add a new key</p>
<p>Each key must be unique through a rule.
For example, below the keys of “profile” are not allowed.</p>
<blockquote>
<div><dl class="docutils">
<dt>{</dt>
<dd>“profile”: { … },
“compression”: { “profile”: … }</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>## Examples</p>
<p>Example 1:</p>
<blockquote>
<div><dl class="docutils">
<dt>{</dt>
<dd>“ruleID” : 14,
“ruleLength” : 4   # rule 0b1110
“compression”: { … }</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>Example 2:</p>
<blockquote>
<div><dl class="docutils">
<dt>{</dt>
<dd><p class="first">“ruleID” : 15,
“ruleLength” : 4   # rule 0b1110
“fragmentationOut”: {</p>
<blockquote>
<div><p>“FRMode” : “noAck” # or “ackAlways”, “ackOnError”
“FRModeProfile” : {</p>
<blockquote>
<div>“dtagSize” : 1,
“WSize”: 3,
“FCNSize” : 3,
“windowSize”, 7,
“ackBehavior”: “afterAll1”</div></blockquote>
<p>}</p>
</div></blockquote>
<p class="last">}</p>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<dl class="class">
<dt id="rulemanager.DictToAttrDeep">
<em class="property">class </em><code class="descclassname">rulemanager.</code><code class="descname">DictToAttrDeep</code><span class="sig-paren">(</span><em>**entries</em><span class="sig-paren">)</span><a class="headerlink" href="#rulemanager.DictToAttrDeep" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="rulemanager.DictToAttrDeep.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>k</em>, <em>d=None</em><span class="sig-paren">)</span><a class="headerlink" href="#rulemanager.DictToAttrDeep.get" title="Permalink to this definition">¶</a></dt>
<dd><p>this.get(k)</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="rulemanager.RuleManager">
<em class="property">class </em><code class="descclassname">rulemanager.</code><code class="descname">RuleManager</code><a class="headerlink" href="#rulemanager.RuleManager" title="Permalink to this definition">¶</a></dt>
<dd><p>RuleManager class is used to manage Compression/Decompression and Fragmentation/
Reassembly rules.</p>
<dl class="method">
<dt id="rulemanager.RuleManager.add_context">
<code class="descname">add_context</code><span class="sig-paren">(</span><em>context</em>, <em>comp=None</em>, <em>fragSender=None</em>, <em>fragReceiver=None</em><span class="sig-paren">)</span><a class="headerlink" href="#rulemanager.RuleManager.add_context" title="Permalink to this definition">¶</a></dt>
<dd><p>add context into the db.</p>
</dd></dl>

<dl class="method">
<dt id="rulemanager.RuleManager.add_rule">
<code class="descname">add_rule</code><span class="sig-paren">(</span><em>context</em>, <em>key</em>, <em>rule</em><span class="sig-paren">)</span><a class="headerlink" href="#rulemanager.RuleManager.add_rule" title="Permalink to this definition">¶</a></dt>
<dd><p>Check rule integrity and uniqueless and add it to the db</p>
</dd></dl>

<dl class="method">
<dt id="rulemanager.RuleManager.add_rules">
<code class="descname">add_rules</code><span class="sig-paren">(</span><em>context</em>, <em>comp=None</em>, <em>fragSender=None</em>, <em>fragReceiver=None</em><span class="sig-paren">)</span><a class="headerlink" href="#rulemanager.RuleManager.add_rules" title="Permalink to this definition">¶</a></dt>
<dd><p>add rules into the context specified.</p>
</dd></dl>

<dl class="method">
<dt id="rulemanager.RuleManager.check_rule_compression">
<code class="descname">check_rule_compression</code><span class="sig-paren">(</span><em>rule</em><span class="sig-paren">)</span><a class="headerlink" href="#rulemanager.RuleManager.check_rule_compression" title="Permalink to this definition">¶</a></dt>
<dd><p>compression rule check</p>
</dd></dl>

<dl class="method">
<dt id="rulemanager.RuleManager.check_rule_fragmentation">
<code class="descname">check_rule_fragmentation</code><span class="sig-paren">(</span><em>rule</em><span class="sig-paren">)</span><a class="headerlink" href="#rulemanager.RuleManager.check_rule_fragmentation" title="Permalink to this definition">¶</a></dt>
<dd><p>fragmentation rule check</p>
</dd></dl>

<dl class="method">
<dt id="rulemanager.RuleManager.find_context_bydevL2addr">
<code class="descname">find_context_bydevL2addr</code><span class="sig-paren">(</span><em>dev_L2addr</em><span class="sig-paren">)</span><a class="headerlink" href="#rulemanager.RuleManager.find_context_bydevL2addr" title="Permalink to this definition">¶</a></dt>
<dd><p>find a context with dev_L2addr.</p>
</dd></dl>

<dl class="method">
<dt id="rulemanager.RuleManager.find_context_bydstiid">
<code class="descname">find_context_bydstiid</code><span class="sig-paren">(</span><em>dst_iid</em><span class="sig-paren">)</span><a class="headerlink" href="#rulemanager.RuleManager.find_context_bydstiid" title="Permalink to this definition">¶</a></dt>
<dd><p>find a context with dst_iid, which can be a wild card.</p>
</dd></dl>

<dl class="method">
<dt id="rulemanager.RuleManager.find_context_exact">
<code class="descname">find_context_exact</code><span class="sig-paren">(</span><em>dev_L2addr</em>, <em>dst_iid</em><span class="sig-paren">)</span><a class="headerlink" href="#rulemanager.RuleManager.find_context_exact" title="Permalink to this definition">¶</a></dt>
<dd><p>find a context by both devL2Addr and dstIID.
This is mainly for internal use.</p>
</dd></dl>

<dl class="method">
<dt id="rulemanager.RuleManager.find_rule_bypacket">
<code class="descname">find_rule_bypacket</code><span class="sig-paren">(</span><em>context</em>, <em>packet_bbuf</em><span class="sig-paren">)</span><a class="headerlink" href="#rulemanager.RuleManager.find_rule_bypacket" title="Permalink to this definition">¶</a></dt>
<dd><p>returns a compression rule or an fragmentation rule
in the context matching with the field value of rule id in the packet.</p>
</dd></dl>

</dd></dl>

<div class="section" id="back-to-the-index">
<h2>Back to the index<a class="headerlink" href="#back-to-the-index" title="Permalink to this headline">¶</a></h2>
<p>Go back to the <a class="reference internal" href="index.html"><span class="doc">index</span></a></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="IETF-104-Hackathon-LPWAN.html" title="previous chapter">IETF Hackathon specific informations</a></li>
      <li>Next: <a href="bitarray.html" title="next chapter">OpenSCHC Bit Buffer Management Module</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="File_Classification.html">File Classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="CONTRIBUTING.html">Contributing Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="Micropython-specificities.html">Micropython specificities</a></li>
<li class="toctree-l1"><a class="reference internal" href="IETF-104-Hackathon-LPWAN.html">IETF Hackathon specific informations</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">OpenSCHC Rule Manager Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="bitarray.html">OpenSCHC Bit Buffer Management Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="schcrecv.html">OpenSCHC Reception Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="comp_parser.html">OpenSCHC Rule Manager Module</a></li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, OpenSCHC.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.7</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.8</a>
      
      |
      <a href="_sources/rulemanager.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>